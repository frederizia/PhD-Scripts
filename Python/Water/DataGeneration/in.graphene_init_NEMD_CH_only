# Sample LAMMP input script for tethered graphene
read_restart  graphene_spce.restart
reset_timestep 0

variable    sigO equal 3.166
variable    epsO equal 0.1553

variable    sigH equal 0.0
variable    epsH equal 0.0

variable    sigC equal 0.0
variable    epsC equal 0.0

variable    sigC_CH equal 2.985
variable    epsC_CH equal 0.046

variable    sigH_CH equal 2.42
variable    epsH_CH equal 0.0301

# C-O LJ parameters Werder et al. JPC B 107, 1345 (2003)
variable    sigCO equal 3.190 
variable    epsCO equal 0.392

pair_style   lj/cut/coul/dsf 0.18 12.0 12.0
pair_coeff   1 1 ${epsO} ${sigO}   	# O-O
pair_coeff   1 2 0.0 0.0  		# O-H
pair_coeff   2 2 0.0 0.0 		# H-H
pair_coeff   1 3 ${epsCO} ${sigCO} 	# O-C
pair_coeff   2 3 0.0 0.0		# H-C
pair_coeff   3 3 ${epsC} ${sigC} 	# C-C
pair_coeff   4 4 ${epsH_CH} ${sigH_CH}	# H_CH-H_CH
pair_coeff   5 5 ${epsC_CH} ${sigC_CH}	# C_CH-C_CH

neigh_modify every 5 delay 0 check yes

#pair_modify  mix arithmetic
bond_style   harmonic
bond_coeff   1 1000.00 1.0
bond_coeff   2 478.40 1.42
bond_coeff   3 500.00 1.08

#bond_coeff   2 0 1.42
angle_style  harmonic
angle_coeff  1 100.0 109.4712
angle_coeff  2 100.0 120

improper_style harmonic
improper_coeff 1 500.0 0


#kspace_style pppm 1.0e-5


special_bonds   lj/coul 0.0 0.0 0.0

fix         SHAKE all shake 0.0001 20 10000 b 1 a 1

variable    T equal 300
variable    P equal 1000
variable    dt equal 2.0
variable    t_thermo equal  100
variable    t_run_init equal 1000000
variable    t_run equal 5000000

group       graphene type 3 5 
group       spce type 1 2 
group       spceO type 1


# Thermostat graphene 
fix         CARBON_THERMOSTAT graphene temp/berendsen $T $T 100.0


#velocity    all create 100.0 1234 dist gaussian mom yes

fix         SPRINGS graphene spring/self 100

#fix         NPT all npt temp $T $T 100.0 z $P $P 2000

#fix         NVT all nvt temp $T $T 100.0

fix         NVE all nve 

# Define profiles
variable    dz equal 0.5 # bin width for spatial averaging
variable    t_win equal ${t_run}/10
variable    t_freq equal 1
variable    t_rep equal ${t_win}/${t_freq}

fix         GENPROF_INIT spce ave/spatial ${t_freq} ${t_rep} ${t_win} &
            z 0 ${dz} density/mass vx vy vz units box norm all   &
            file genprof_spce_init_nemd.dat

variable    dz_stress equal 1.0
variable    t_win_stress equal ${t_run}/10
variable    t_freq_stress equal 2
variable    t_rep_stress equal ${t_win_stress}/${t_freq_stress}

compute     STRESS_SPCE spce stress/atom 

fix         STRESS_INIT spce ave/spatial ${t_freq_stress} ${t_rep_stress} &
            ${t_win_stress} z 0 ${dz_stress} &
            c_STRESS_SPCE[1] c_STRESS_SPCE[2] c_STRESS_SPCE[3] &
            c_STRESS_SPCE[4] c_STRESS_SPCE[5] c_STRESS_SPCE[6] &
            units box norm all file stress_prof_init.dat


# Set up region to apply external force

variable    l_f equal 10.0
variable    zlo_f equal zlo
variable    zhi_f equal ${zlo_f}+${l_f}
variable    xlo_f equal xlo
variable    xhi_f equal xhi
variable    ylo_f equal ylo
variable    yhi_f equal yhi
region      field_slab block ${xlo_f} ${xhi_f} ${ylo_f} ${yhi_f} &
                             ${zlo_f} ${zhi_f} units box

print "slab extents: ${xlo_f} ${xhi_f}  ${ylo_f} ${yhi_f}  ${zlo_f} ${zhi_f}"

variable    f_fac index 1.0

# External Force
variable    f_ext equal ${f_fac}*${epsO}/${sigO}
print       "External force = ${f_ext} (kcal/mole/Angstrom)"
fix         EXT_FORCE spceO addforce 0.0 0.0 ${f_ext} region field_slab



timestep    ${dt}

thermo      ${t_thermo}
thermo_style custom step temp ke pe etotal press vol f_CARBON_THERMOSTAT &
             f_EXT_FORCE[1] f_EXT_FORCE[2] f_EXT_FORCE[3]

## Initial Run

dump        PRINTXYZ_INIT all xyz 1000 graphene_run_init_nemd.xyz
dump_modify PRINTXYZ_INIT element O H C H C
run         ${t_run_init}

write_restart graphene_spce_nemd_init.restart

## Production Run

unfix       GENPROF_INIT
unfix       STRESS_INIT
undump      PRINTXYZ_INIT

variable    t_win_stress equal ${t_run}/1

fix         GENPROF_X spce ave/spatial ${t_freq} ${t_rep} ${t_win} &
            x 0 ${dz} density/mass vx vy vz units box norm all   &
            file genprof_spce_x.dat

fix         GENPROF_XZ spce ave/spatial ${t_freq} ${t_rep} ${t_win} &
            x 0 ${dz} z 0 ${dz} density/mass vx vy vz units box norm all   &
            file genprof_spce_xz.dat

fix         GENPROF_Z spce ave/spatial ${t_freq} ${t_rep} ${t_win} &
            z 0 ${dz} density/mass vx vy vz units box norm all   &
            file genprof_spce_z.dat

fix         STRESS spce ave/spatial ${t_freq_stress} ${t_rep_stress} &
            ${t_win_stress} z 0 ${dz_stress} &
            c_STRESS_SPCE[1] c_STRESS_SPCE[2] c_STRESS_SPCE[3] &
            c_STRESS_SPCE[4] c_STRESS_SPCE[5] c_STRESS_SPCE[6] &
            units box norm all file stress_prof.dat

dump        PRINTXYZ all xyz 1000 graphene_run_nemd.xyz
dump_modify PRINTXYZ element O H C H_CH C_CH

run         ${t_run}
write_restart graphene_spce_nemd.restart

